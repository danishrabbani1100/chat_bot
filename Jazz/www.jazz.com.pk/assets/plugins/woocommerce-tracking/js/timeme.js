(function(){(function(root,factory){if(typeof module!=='undefined'&&module.exports){return module.exports=factory(require('ifvisible.js'));}else if(typeof define==='function'&&define.amd){define(['ifvisible'],function(ifvisible){return(root.TimeMe=factory(ifvisible));});}else{return root.TimeMe=factory(root.ifvisible);}})(this,function(ifvisible){var TimeMe={startStopTimes:{},idleTimeout:60,currentPageName:"default-page-name",getIfVisibleHandle:function(){if(typeof ifvisible==='object'){return ifvisible;}else{if(typeof console!=="undefined"){console.log("Required dependency (ifvisible.js) not found.  Make sure it has been included.");}
throw{name:"MissingDependencyException",message:"Required dependency (ifvisible.js) not found.  Make sure it has been included."};}},startTimer:function(){var pageName=TimeMe.currentPageName;if(TimeMe.startStopTimes[pageName]===undefined){TimeMe.startStopTimes[pageName]=[];}else{var arrayOfTimes=TimeMe.startStopTimes[pageName];var latestStartStopEntry=arrayOfTimes[arrayOfTimes.length-1];if(latestStartStopEntry!==undefined&&latestStartStopEntry.stopTime===undefined){return;}}
TimeMe.startStopTimes[pageName].push({"startTime":new Date(),"stopTime":undefined});},stopTimer:function(){var pageName=TimeMe.currentPageName;var arrayOfTimes=TimeMe.startStopTimes[pageName];if(arrayOfTimes===undefined||arrayOfTimes.length===0){return;}
if(arrayOfTimes[arrayOfTimes.length-1].stopTime===undefined){arrayOfTimes[arrayOfTimes.length-1].stopTime=new Date();}},getTimeOnCurrentPageInSeconds:function(){return TimeMe.getTimeOnPageInSeconds(TimeMe.currentPageName);},getTimeOnPageInSeconds:function(pageName){var totalTimeOnPage=0;var arrayOfTimes=TimeMe.startStopTimes[pageName];if(arrayOfTimes===undefined){return;}
var timeSpentOnPageInSeconds=0;for(var i=0;i<arrayOfTimes.length;i++){var startTime=arrayOfTimes[i].startTime;var stopTime=arrayOfTimes[i].stopTime;if(stopTime===undefined){stopTime=new Date();}
var difference=stopTime-startTime;timeSpentOnPageInSeconds+=(difference/1000);}
totalTimeOnPage=Number(timeSpentOnPageInSeconds);return totalTimeOnPage;},getTimeOnAllPagesInSeconds:function(){var allTimes=[];var pageNames=Object.keys(TimeMe.startStopTimes);for(var i=0;i<pageNames.length;i++){var pageName=pageNames[i];var timeOnPage=TimeMe.getTimeOnPageInSeconds(pageName);allTimes.push({"pageName":pageName,"timeOnPage":timeOnPage});}
return allTimes;},setIdleDurationInSeconds:function(duration){var durationFloat=parseFloat(duration);if(isNaN(durationFloat)===false){TimeMe.getIfVisibleHandle().setIdleDuration(durationFloat);TimeMe.idleTimeout=durationFloat;}else{throw{name:"InvalidDurationException",message:"An invalid duration time ("+duration+") was provided."};}},setCurrentPageName:function(pageName){TimeMe.currentPageName=pageName;},resetRecordedPageTime:function(pageName){delete TimeMe.startStopTimes[pageName];},resetAllRecordedPageTimes:function(){var pageNames=Object.keys(TimeMe.startStopTimes);for(var i=0;i<pageNames.length;i++){TimeMe.resetRecordedPageTime(pageNames[i]);}},listenForVisibilityEvents:function(){TimeMe.getIfVisibleHandle().on("blur",function(){TimeMe.stopTimer();});TimeMe.getIfVisibleHandle().on("focus",function(){TimeMe.startTimer();});TimeMe.getIfVisibleHandle().on("idle",function(){if(TimeMe.idleTimeout>0){TimeMe.stopTimer();}});TimeMe.getIfVisibleHandle().on("wakeup",function(){if(TimeMe.idleTimeout>0){TimeMe.startTimer();}});},initialize:function(){TimeMe.listenForVisibilityEvents();TimeMe.startTimer();}};return TimeMe;});}).call(this);